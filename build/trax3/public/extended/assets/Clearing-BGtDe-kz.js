import{_ as U}from"./TasksLayout-BcOeq5lv.js";import{g as u,o as d,c as p,d as a,u as f,w as s,F as k,Z as L,e as $,a as c,j as g,t as M}from"./app-BqYB4w7h.js";import{_ as r}from"./InputLabel-B012P3ON.js";import{_ as N}from"./TextInput-Bd33mpYb.js";import{_ as v}from"./Select-I1X3nauV.js";import{u as Y,_ as B}from"./JobsManagement-BhfjSFNe.js";import{_ as h}from"./JobLogs-CCjrTMq8.js";import"./AuthenticatedLayout-DmkbqqwL.js";import"./TopBar-CSycyVTE.js";import"./ApplicationLogo-CbRF8qXe.js";import"./form-BD1T68Go.js";import"./use-resolve-button-type-zbaL4VAc.js";import"./calculate-active-index-CJPhqQS-.js";import"./use-text-value-5zAQL0RU.js";import"./use-tree-walker-CEHhLUFs.js";import"./InputError-_zuJ5dV-.js";import"./NeutralBadge-Cx27iNjU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ChevronUpDownIcon-BxOM5Ujt.js";import"./FormModal--OgS4LYv.js";import"./PrimaryButton-JrsBxlP3.js";import"./transition-CSxLRhS2.js";import"./disposables-CuHKeC00.js";import"./ConfirmModal-DdIInXQ7.js";import"./moment-Cl4UOzQZ.js";import"./PencilSquareIcon-CqSWVHZD.js";import"./DataPanel-eTawuoZh.js";import"./CrudItems-BFkrHaNx.js";import"./LoadItems-f7CjgfCr.js";import"./FilterItems-DtKLW4qf.js";const F={class:"px-6"},H={key:0,class:"mt-5 px-6"},W={class:"mt-5 px-6"},E={key:1,class:"mt-5 px-6"},J={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},b="/trax/api/gateway/front/jobs/clearing",ye={__name:"Clearing",setup(T){const x={service:"statements",until:"now",until_date:"",store:null},{localDateWithSeconds:_,formatIsoDate:A,untilOptions:V,untilNotice:y}=Y(),l=u([{id:null,name:"All stores"}]),P=t=>new Promise((e,o)=>{axios.get("/trax/api/gateway/front/stores").then(I=>{l.value=I.data.data.filter(n=>n.status==="ready").map(n=>({id:n.slug,name:n.name})),l.value.unshift({id:null,name:"All stores"}),e()})}),j=t=>{let e=[];return t.settings.until=="date"&&e.push("Until "+_(t.settings.until_date)),t.description=e.join("<br>"),t},S=(t,e)=>e=="until"?t.settings.until:e=="until_date"&&t.settings.until_date?_(t.settings.until_date):t[e]===void 0?null:t[e],C=(t,e)=>e=="until_date"&&t.until_date?A(t.until_date):e=="service"?m.value=="all"?"all":t.service:t[e],D=[{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],O=[{id:null,name:"All services"},{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],w=[{id:"all",name:"Clear all databases"},{id:"database",name:"Clear a given database"}],m=u(""),i=u(null);return(t,e)=>(d(),p(k,null,[a(f(L),{title:"Clearing"}),a(U,{"side-menu-current":"Clearing"},{default:s(()=>[a(B,{endpoint:b,title:"Clearing",jobProps:x,beforeItemLoading:P,afterItemLoading:j,afterPropLoading:S,beforePropPosting:C,addOptions:w,onInit:e[5]||(e[5]=o=>i.value=o),onAddJob:e[6]||(e[6]=o=>m.value=o),services:O},{description:s(()=>[$(" You can create jobs to remove xAPI data which is not relevant anymore. ")]),form:s(()=>[c("div",F,[a(r,{value:"Store"}),a(v,{id:"store",options:l.value,modelValue:i.value.form.store,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.form.store=o),class:"mt-1"},null,8,["options","modelValue"])]),m.value!="all"?(d(),p("div",H,[a(r,{value:"Database"}),a(v,{id:"service",options:D,modelValue:i.value.form.service,"onUpdate:modelValue":e[1]||(e[1]=o=>i.value.form.service=o),class:"mt-1"},null,8,["modelValue"])])):g("",!0),c("div",W,[a(r,{value:"Data recorded until"}),a(v,{id:"until",options:f(V),modelValue:i.value.form.until,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.form.until=o),class:"mt-1"},null,8,["options","modelValue"])]),i.value.form.until=="date"?(d(),p("div",E,[a(r,{for:"until_date",value:"Date"}),a(N,{id:"until_date",placeholder:"YYYY-MM-DD HH:MM:SS",modelValue:i.value.form.until_date,"onUpdate:modelValue":e[3]||(e[3]=o=>i.value.form.until_date=o),error:i.value.errors.until_date,"onUpdate:error":e[4]||(e[4]=o=>i.value.errors.until_date=o),onApply:i.value.createOrUpdate,class:"mt-1"},null,8,["modelValue","error","onApply"]),c("div",J,M(f(y)(i.value.form.until_date)),1)])):g("",!0)]),feedback:s(()=>[a(h,{job:i.value.job,endpoint:b},null,8,["job"])]),_:1})]),_:1})],64))}};export{ye as default};
