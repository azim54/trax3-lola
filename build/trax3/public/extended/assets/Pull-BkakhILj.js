import{_ as R}from"./TasksLayout-BcOeq5lv.js";import{g as f,h as Y,o as s,c as n,d as l,u as A,w as E,F as w,Z as H,e as $,a as T,t as b,b as B,j as u}from"./app-BqYB4w7h.js";import{_ as m}from"./InputLabel-B012P3ON.js";import{_ as y}from"./TextInput-Bd33mpYb.js";import{_ as g}from"./Select-I1X3nauV.js";import{_ as r}from"./Checkbox-CesKyGxn.js";import{u as G,_ as q}from"./JobsManagement-BhfjSFNe.js";import{_ as K}from"./JobLogs-CCjrTMq8.js";import"./AuthenticatedLayout-DmkbqqwL.js";import"./TopBar-CSycyVTE.js";import"./ApplicationLogo-CbRF8qXe.js";import"./form-BD1T68Go.js";import"./use-resolve-button-type-zbaL4VAc.js";import"./calculate-active-index-CJPhqQS-.js";import"./use-text-value-5zAQL0RU.js";import"./use-tree-walker-CEHhLUFs.js";import"./InputError-_zuJ5dV-.js";import"./NeutralBadge-Cx27iNjU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ChevronUpDownIcon-BxOM5Ujt.js";import"./FormModal--OgS4LYv.js";import"./PrimaryButton-JrsBxlP3.js";import"./transition-CSxLRhS2.js";import"./disposables-CuHKeC00.js";import"./ConfirmModal-DdIInXQ7.js";import"./moment-Cl4UOzQZ.js";import"./PencilSquareIcon-CqSWVHZD.js";import"./DataPanel-eTawuoZh.js";import"./CrudItems-BFkrHaNx.js";import"./LoadItems-f7CjgfCr.js";import"./FilterItems-DtKLW4qf.js";const W={class:"px-6"},X={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},J={key:0,class:"mt-5 px-6"},Z={key:1,class:"mt-5 px-6"},z={key:2,class:"mt-5 px-6"},Q={key:3,class:"mt-5 px-6"},ee={key:4,class:"mt-5 px-6"},te={key:5,class:"mt-5 px-6"},ae={key:6,class:"mt-5 px-6"},le={key:7,class:"mt-5 px-6"},oe={key:8,class:"mt-5 px-6"},se={key:9,class:"mt-5 px-6"},ie={key:10,class:"mt-5 px-6"},ne={key:11,class:"mt-5 px-6"},de={key:12,class:"mt-5 px-6"},ue={key:13,class:"mt-5 px-6"},re={key:14,class:"mt-5 px-6"},me={key:15,class:"mt-5 px-6"},ve={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},_e="/trax/api/gateway/front/connections/",D="/trax/api/gateway/front/jobs/pull",Ge={__name:"Pull",props:{settings:{type:Object,required:!0}},setup(U){const i=U,v=f(""),P=f([{id:0,name:"No connection"}]),d=Y(()=>e.value?e.value.form.connection>0:!1),x={service:"statements",until:"now",until_date:"",connection:0,validate_statements:i.settings.PIPELINE_DEFAULT_VALIDATE_STATEMENTS,check_conflicts:i.settings.PIPELINE_DEFAULT_CHECK_CONFLICTS,void_statements:i.settings.PIPELINE_DEFAULT_VOID_STATEMENTS,update_activities:i.settings.PIPELINE_DEFAULT_UPDATE_ACTIVITIES,update_agents:i.settings.PIPELINE_DEFAULT_UPDATE_AGENTS,update_vocab:i.settings.PIPELINE_DEFAULT_UPDATE_VOCAB,update_activity_ids:i.settings.PIPELINE_DEFAULT_UPDATE_ACTIVITY_IDS,update_agent_ids:i.settings.PIPELINE_DEFAULT_UPDATE_AGENT_IDS,authority_name:i.settings.XAPI_STATEMENTS_AUTHORITY_NAME,authority_homepage:i.settings.XAPI_STATEMENTS_AUTHORITY_HOMEPAGE,store:"default"},{localDateWithSeconds:V,formatIsoDate:L,untilOptions:N,untilNotice:S}=G(),I=f([{id:"default",name:"Default store"}]),k=o=>new Promise((t,a)=>{let _=!1;o&&(v.value=o.connection.type),axios.get(_e+v.value).then(p=>{p.data.data.length&&(P.value=p.data.data,e.value.form.connection=P.value[0].id),_?t():_=!0}),axios.get("/trax/api/gateway/front/stores").then(p=>{I.value=p.data.data.filter(c=>c.status==="ready").map(c=>({id:c.slug,name:c.name})),e.value.form.store_id=I.value[0].id,_?t():_=!0})}),C=o=>{let t=[];return o.settings.until=="date"&&t.push("Until "+V(o.settings.until_date)),o.connection&&t.push(o.connection.type.toUpperCase()+": "+o.connection.name),o.description=t.join("<br>"),o},h=(o,t)=>["until","connection","validate_statements","check_conflicts","void_statements","update_activities","update_agents","update_vocab","update_activity_ids","update_agent_ids","authority_name","authority_homepage"].includes(t)?o.settings[t]:t=="until_date"&&o.settings.until_date?V(o.settings.until_date):o[t]===void 0?null:o[t],O=(o,t)=>t=="until_date"&&o.until_date?L(o.until_date):o[t],F=[{id:"all",name:"All"},{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],j=[{id:null,name:"All services"},{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],M=[{id:"file",name:"Pull from files"},{id:"lrs",name:"Pull from an LRS"},{id:"db",name:"Pull from a database"}],e=f(null);return(o,t)=>(s(),n(w,null,[l(A(H),{title:"Pull"}),l(R,{"side-menu-current":"Pull"},{default:E(()=>[l(q,{endpoint:D,title:"Pull",jobProps:x,afterItemLoading:C,afterPropLoading:h,beforePropPosting:O,beforeItemLoading:k,addOptions:M,onInit:t[18]||(t[18]=a=>e.value=a),onAddJob:t[19]||(t[19]=a=>v.value=a),formDisabled:!d.value,services:j},{description:E(()=>[$(" You can create jobs to pull xAPI data from an external source. ")]),form:E(()=>[T("div",W,[l(m,{value:"Connection"}),e.value.form.connection==0?(s(),n("div",X," There is currently no '"+b(v.value)+"' connection available. You should first configure a connection in the access tab, and then come back to define pull or push jobs. ",1)):(s(),B(g,{key:1,id:"connection",options:P.value,modelValue:e.value.form.connection,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.form.connection=a),class:"mt-1"},null,8,["options","modelValue"]))]),d.value?(s(),n("div",J,[l(m,{value:"Store"}),l(g,{id:"store",options:I.value,modelValue:e.value.form.store,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value.form.store=a),class:"mt-1"},null,8,["options","modelValue"])])):u("",!0),d.value&&v.value!=="lrs"?(s(),n("div",Z,[l(m,{value:"Database"}),l(g,{id:"service",options:F,modelValue:e.value.form.service,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value.form.service=a),class:"mt-1"},null,8,["modelValue"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",z,[l(m,{value:"xAPI pipeline"})])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",Q,[l(r,{id:"validate_statements",label:"Validate statements",modelValue:e.value.form.validate_statements,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value.form.validate_statements=a),disabled:i.settings.PIPELINE_FORCED_VALIDATE_STATEMENTS},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",ee,[l(r,{id:"check_conflicts",label:"Check ID conflicts",modelValue:e.value.form.check_conflicts,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.form.check_conflicts=a),disabled:i.settings.PIPELINE_FORCED_CHECK_CONFLICTS},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",te,[l(r,{id:"void_statements",label:"Void statements",modelValue:e.value.form.void_statements,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.form.void_statements=a),disabled:i.settings.PIPELINE_FORCED_VOID_STATEMENTS},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",ae,[l(r,{id:"update_activities",label:"Update activity definitions",modelValue:e.value.form.update_activities,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.form.update_activities=a),disabled:i.settings.PIPELINE_FORCED_UPDATE_ACTIVITIES},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",le,[l(r,{id:"update_agents",label:"Update agent definitions",modelValue:e.value.form.update_agents,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value.form.update_agents=a),disabled:i.settings.PIPELINE_FORCED_UPDATE_AGENTS},null,8,["modelValue","disabled"])])):u("",!0),d.value?(s(),n("div",oe,[l(r,{id:"update_vocab",label:"Update vocabulary",modelValue:e.value.form.update_vocab,"onUpdate:modelValue":t[8]||(t[8]=a=>e.value.form.update_vocab=a),disabled:i.settings.PIPELINE_FORCED_UPDATE_VOCAB},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","activities","all"].includes(e.value.form.service)?(s(),n("div",se,[l(r,{id:"update_activity_ids",label:"Update activity IDs registry",modelValue:e.value.form.update_activity_ids,"onUpdate:modelValue":t[9]||(t[9]=a=>e.value.form.update_activity_ids=a),disabled:i.settings.PIPELINE_FORCED_UPDATE_ACTIVITY_IDS},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","agents","all"].includes(e.value.form.service)?(s(),n("div",ie,[l(r,{id:"update_agent_ids",label:"Update agent IDs registry",modelValue:e.value.form.update_agent_ids,"onUpdate:modelValue":t[10]||(t[10]=a=>e.value.form.update_agent_ids=a),disabled:i.settings.PIPELINE_FORCED_UPDATE_AGENT_IDS},null,8,["modelValue","disabled"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",ne,[l(m,{value:"Authority"})])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",de,[l(y,{id:"authority_name",placeholder:"Account name",modelValue:e.value.form.authority_name,"onUpdate:modelValue":t[11]||(t[11]=a=>e.value.form.authority_name=a),error:e.value.errors.authority_name,"onUpdate:error":t[12]||(t[12]=a=>e.value.errors.authority_name=a),class:"mt-1"},null,8,["modelValue","error"])])):u("",!0),d.value&&["statements","all"].includes(e.value.form.service)?(s(),n("div",ue,[l(y,{id:"authority_homepage",placeholder:"Account homePage",modelValue:e.value.form.authority_homepage,"onUpdate:modelValue":t[13]||(t[13]=a=>e.value.form.authority_homepage=a),error:e.value.errors.authority_homepage,"onUpdate:error":t[14]||(t[14]=a=>e.value.errors.authority_homepage=a),class:"mt-1"},null,8,["modelValue","error"])])):u("",!0),d.value?(s(),n("div",re,[l(m,{value:"Data recorded until"}),l(g,{id:"until",options:A(N),modelValue:e.value.form.until,"onUpdate:modelValue":t[15]||(t[15]=a=>e.value.form.until=a),class:"mt-1"},null,8,["options","modelValue"])])):u("",!0),e.value.form.until=="date"?(s(),n("div",me,[l(m,{for:"until_date",value:"Date"}),l(y,{id:"until_date",placeholder:"YYYY-MM-DD HH:MM:SS",modelValue:e.value.form.until_date,"onUpdate:modelValue":t[16]||(t[16]=a=>e.value.form.until_date=a),error:e.value.errors.until_date,"onUpdate:error":t[17]||(t[17]=a=>e.value.errors.until_date=a),onApply:e.value.createOrUpdate,class:"mt-1"},null,8,["modelValue","error","onApply"]),T("div",ve,b(A(S)(e.value.form.until_date)),1)])):u("",!0)]),feedback:E(()=>[l(K,{job:e.value.job,endpoint:D},null,8,["job"])]),_:1},8,["formDisabled"])]),_:1})],64))}};export{Ge as default};
