import{u as A}from"./LoadItems-f7CjgfCr.js";import{g as u,f as J,m as S}from"./app-BqYB4w7h.js";function G(l,s,r={}){const{loadItems:n,loadMoreItems:y,loadedCounter:O,loadedItems:E,loadingErrors:P,hasMoreItems:j,loadingItems:L}=A(l,r),a=u(!1),o=u(!1),i=u(!1),d=u(!1),f=u(!1),m=J({...s}),x=JSON.parse(JSON.stringify(s));S(()=>{(!l.settings||l.settings.autoload!==!1)&&n()});const I=(e,t)=>typeof t=="object"&&!Array.isArray(t)&&t!==null?Object.getOwnPropertyNames(t).length===0?t:(Object.keys(t).forEach(c=>{e[c]=I(e[c],t[c])}),e):t,C=()=>{s=I(s,x),h(),r.beforeItemLoading?r.beforeItemLoading().then(()=>{o.value=!0}):o.value=!0},F=e=>{r.beforeItemLoading?r.beforeItemLoading(e).then(()=>v(e)):v(e)},v=e=>{axios.get(l.url+"/"+e.id).then(t=>{g(t.data.data),h(),o.value=!0})},g=e=>{Object.keys(s).forEach(t=>{let c=e[t]===void 0?null:e[t];s[t]=r.afterPropLoading?r.afterPropLoading(e,t):c})},M=()=>s.id?N():D(),D=()=>{a.value=!0,axios.post(l.url,b()).then(e=>{a.value=!1,o.value=!1,n()}).catch(e=>{a.value=!1,e.response&&e.response.status==422&&p(e.response.data)})},N=()=>{a.value=!0,axios.put(l.url+"/"+s.id,b()).then(e=>{a.value=!1,o.value=!1,n()}).catch(e=>{a.value=!1,e.response&&e.response.status==422&&p(e.response.data)})},b=()=>{let e={};return Object.keys(s).forEach(t=>{e[t]=r.beforePropPosting?r.beforePropPosting(s,t):s[t]}),e},p=e=>{Object.keys(e.errors).forEach(t=>{m[t]=e.errors[t][0]})},h=()=>{Object.keys(m).forEach(e=>{m[e]=""})};return{createItem:C,confirmCreateOrUpdateItem:M,updateItem:F,updateItemForm:g,deleteItem:e=>{s.id=e.id,i.value=!0},confirmDeleteItem:()=>{a.value=!0,axios.delete(l.url+"/"+s.id).then(e=>{a.value=!1,i.value=!1,n()}).catch(e=>{a.value=!1,i.value=!1,e.response&&e.response.status==409&&(d.value=!0)})},clearItems:()=>{f.value=!0},confirmClearItems:()=>{a.value=!0,axios.delete(l.url).then(e=>{a.value=!1,f.value=!1,n()}).catch(e=>{a.value=!1,f.value=!1,e.response&&e.response.status==409&&(d.value=!0)})},isProcessingItem:a,itemFormVisible:o,deleteItemModalVisible:i,deleteItemWarningVisible:d,clearItemsModalVisible:f,itemFormErrors:m,loadItems:n,loadedItems:E,loadMoreItems:y,loadedCounter:O,loadingErrors:P,hasMoreItems:j,loadingItems:L}}export{G as u};
