import{_ as Y}from"./TasksLayout-BcOeq5lv.js";import{g as f,h as C,o as a,c as i,d as s,u as b,w as v,F as M,Z as B,e as E,a as V,t as h,b as k,j as l}from"./app-BqYB4w7h.js";import{_ as m}from"./InputLabel-B012P3ON.js";import{_ as R}from"./TextInput-Bd33mpYb.js";import{_}from"./Select-I1X3nauV.js";import{_ as x}from"./Checkbox-CesKyGxn.js";import{u as T,_ as F}from"./JobsManagement-BhfjSFNe.js";import{_ as H}from"./JobLogs-CCjrTMq8.js";import"./AuthenticatedLayout-DmkbqqwL.js";import"./TopBar-CSycyVTE.js";import"./ApplicationLogo-CbRF8qXe.js";import"./form-BD1T68Go.js";import"./use-resolve-button-type-zbaL4VAc.js";import"./calculate-active-index-CJPhqQS-.js";import"./use-text-value-5zAQL0RU.js";import"./use-tree-walker-CEHhLUFs.js";import"./InputError-_zuJ5dV-.js";import"./NeutralBadge-Cx27iNjU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ChevronUpDownIcon-BxOM5Ujt.js";import"./FormModal--OgS4LYv.js";import"./PrimaryButton-JrsBxlP3.js";import"./transition-CSxLRhS2.js";import"./disposables-CuHKeC00.js";import"./ConfirmModal-DdIInXQ7.js";import"./moment-Cl4UOzQZ.js";import"./PencilSquareIcon-CqSWVHZD.js";import"./DataPanel-eTawuoZh.js";import"./CrudItems-BFkrHaNx.js";import"./LoadItems-f7CjgfCr.js";import"./FilterItems-DtKLW4qf.js";const W={class:"px-6"},q={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},J={class:"mt-5 px-6"},Z={key:0,class:"mt-5 px-6"},G={key:1,class:"mt-5 px-6"},K={key:2,class:"mt-5 px-6"},Q={key:3,class:"mt-5 px-6"},X={key:4,class:"mt-5 px-6"},ee={key:5,class:"mt-5 px-6"},te={class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},oe="/trax/api/gateway/front/connections/",A="/trax/api/gateway/front/jobs/push",$e={__name:"Push",setup(ne){const r=f(""),y=f([{id:0,name:"No connection"}]),u=C(()=>t.value?t.value.form.connection>0:!1),w={service:"statements",until:"now",until_date:"",connection:0,raw:!1,pseudonymize_statements:!1,sync_updates:!1,store:"default"},{localDateWithSeconds:P,formatIsoDate:S,untilOptions:j,untilNotice:U}=T(),g=f([{id:"default",name:"Default store"}]),D=o=>new Promise((e,n)=>{let d=!1;o&&(r.value=o.connection.type),axios.get(oe+r.value).then(c=>{c.data.data.length&&(y.value=c.data.data,t.value.form.connection=y.value[0].id),d?e():d=!0}),axios.get("/trax/api/gateway/front/stores").then(c=>{g.value=c.data.data.filter(p=>p.status==="ready").map(p=>({id:p.slug,name:p.name})),t.value.form.store_id=g.value[0].id,d?e():d=!0})}),z=o=>{let e=[];return o.settings.until=="date"&&e.push("Until "+P(o.settings.until_date)),o.connection&&e.push(o.connection.type.toUpperCase()+": "+o.connection.name),o.settings.raw&&o.service=="statements"&&e.push("Raw format"),o.settings.pseudonymize_statements&&o.service=="statements"&&e.push("Pseudonymize statements"),o.settings.sync_updates&&o.service!="statements"&&e.push("Sync updates"),o.description=e.join("<br>"),o},O=(o,e)=>["until","connection","raw","pseudonymize_statements","sync_updates"].includes(e)?o.settings[e]:e=="until_date"&&o.settings.until_date?P(o.settings.until_date):o[e]===void 0?null:o[e],I=(o,e)=>e=="until_date"&&o.until_date?S(o.until_date):o[e],L=[{id:"all",name:"All"},{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],$=[{id:null,name:"All services"},{id:"statements",name:"Statements"},{id:"activities",name:"Activities"},{id:"agents",name:"Agents"},{id:"activity-profiles",name:"Activity Profiles"},{id:"agent-profiles",name:"Agent Profiles"},{id:"states",name:"States"}],N=[{id:"file",name:"Push to files"},{id:"lrs",name:"Push to an LRS"},{id:"db",name:"Push to a database"}],t=f(null);return(o,e)=>(a(),i(M,null,[s(b(B),{title:"Push"}),s(Y,{"side-menu-current":"Push"},{default:v(()=>[s(F,{endpoint:A,title:"Push",jobProps:w,afterItemLoading:z,afterPropLoading:O,beforePropPosting:I,beforeItemLoading:D,addOptions:N,onInit:e[9]||(e[9]=n=>t.value=n),onAddJob:e[10]||(e[10]=n=>r.value=n),formDisabled:!u.value,services:$},{description:v(()=>[E(" You can create jobs to push xAPI data to an external storage. ")]),form:v(()=>[V("div",W,[s(m,{value:"Connection"}),t.value.form.connection==0?(a(),i("div",q," There is currently no '"+h(r.value)+"' connection available. You should first configure a connection in the access tab, and then come back to define pull or push jobs. ",1)):(a(),k(_,{key:1,id:"connection",options:y.value,modelValue:t.value.form.connection,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.form.connection=n),class:"mt-1"},null,8,["options","modelValue"]))]),V("div",J,[s(m,{value:"Store"}),s(_,{id:"store",options:g.value,modelValue:t.value.form.store,"onUpdate:modelValue":e[1]||(e[1]=n=>t.value.form.store=n),class:"mt-1"},null,8,["options","modelValue"])]),u.value?(a(),i("div",Z,[s(m,{value:"Database"}),s(_,{id:"service",options:L,modelValue:t.value.form.service,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.form.service=n),class:"mt-1",disabled:r.value=="lrs"},null,8,["modelValue","disabled"])])):l("",!0),u.value&&["statements","all"].includes(t.value.form.service)?(a(),i("div",G,[r.value=="file"?(a(),k(x,{key:0,id:"raw",label:"Export statements in raw format",modelValue:t.value.form.raw,"onUpdate:modelValue":e[3]||(e[3]=n=>t.value.form.raw=n)},null,8,["modelValue"])):l("",!0)])):l("",!0),u.value&&["statements","all"].includes(t.value.form.service)?(a(),i("div",K,[s(x,{id:"pseudonymize_statements",label:"Pseudonymize statements",modelValue:t.value.form.pseudonymize_statements,"onUpdate:modelValue":e[4]||(e[4]=n=>t.value.form.pseudonymize_statements=n)},null,8,["modelValue"])])):l("",!0),t.value.form.service!="statements"?(a(),i("div",Q,[s(x,{id:"sync_updates",label:"Sync updates",modelValue:t.value.form.sync_updates,"onUpdate:modelValue":e[5]||(e[5]=n=>t.value.form.sync_updates=n)},null,8,["modelValue"])])):l("",!0),u.value?(a(),i("div",X,[s(m,{value:"Data recorded until"}),s(_,{id:"until",options:b(j),modelValue:t.value.form.until,"onUpdate:modelValue":e[6]||(e[6]=n=>t.value.form.until=n),class:"mt-1"},null,8,["options","modelValue"])])):l("",!0),t.value.form.until=="date"?(a(),i("div",ee,[s(m,{for:"until_date",value:"Date"}),s(R,{id:"until_date",placeholder:"YYYY-MM-DD HH:MM:SS",modelValue:t.value.form.until_date,"onUpdate:modelValue":e[7]||(e[7]=n=>t.value.form.until_date=n),error:t.value.errors.until_date,"onUpdate:error":e[8]||(e[8]=n=>t.value.errors.until_date=n),onApply:t.value.createOrUpdate,class:"mt-1"},null,8,["modelValue","error","onApply"]),V("div",te,h(b(U)(t.value.form.until_date)),1)])):l("",!0)]),feedback:v(()=>[s(H,{job:t.value.job,endpoint:A},null,8,["job"])]),_:1},8,["formDisabled"])]),_:1})],64))}};export{$e as default};
